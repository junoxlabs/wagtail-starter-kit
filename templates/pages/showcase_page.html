{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
    <div class="showcase-page">
        <h1 class="text-3xl font-bold mb-6">{{ page.title }}</h1>

        {% if page.category_filter %}
            <p class="text-lg mb-4">Category: {{ page.category_filter.name }}</p>
        {% endif %}

        {% with entities_by_category=page.get_entities_by_category %}
            {% if entities_by_category %}
                {% for category_name, entities in entities_by_category.items %}
                    <div class="category-section mb-8">
                        <h2 class="text-2xl font-semibold mb-4 border-b pb-2">{{ category_name }}</h2>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {% for entity in entities %}
                                <div class="entity-card bg-white rounded-lg shadow-md p-6">
                                    <h3 class="text-xl font-bold mb-2">
                                        <a href="{{ entity.url }}" class="text-blue-600 hover:underline">
                                            {{ entity.title }}
                                        </a>
                                    </h3>

                                    {% if entity.specific.image %}
                                        <div class="mb-4">
                                            {% image entity.specific.image fill-300x200 class="w-full h-48 object-cover rounded" %}
                                        </div>
                                    {% endif %}

                                    <p class="text-gray-700 mb-4">{{ entity.specific.description|truncatewords:30 }}</p>

                                    {% if entity.specific.links.all %}
                                        <div class="links-section">
                                            <h4 class="font-semibold mb-2">Links:</h4>
                                            <ul class="list-disc pl-5">
                                                {% for link_item in entity.specific.links.all %}
                                                    <li>
                                                        <a href="{{ link_item.link.url }}" target="_blank" class="text-blue-500 hover:underline">
                                                            {{ link_item.link.title }} ({{ link_item.link.get_link_type_display }})
                                                        </a>
                                                    </li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    {% endif %}

                                    <div class="mt-4 text-sm text-gray-500">
                                        <p>URL Type: {{ entity.get_url_type_preference_display }}</p>
                                        {% if entity.url_type_preference == 'uuid' %}
                                            <p>UUID URL: <a href="{{ entity.get_uuid_url }}" class="text-blue-500 hover:underline">{{ entity.get_uuid_url }}</a></p>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="text-gray-500">No {{ page.get_entity_types_to_display_display }} found{% if page.category_filter %} in the {{ page.category_filter.name }} category{% endif %}.</p>
            {% endif %}
        {% endwith %}
    </div>
{% endblock %}
